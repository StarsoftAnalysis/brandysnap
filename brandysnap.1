.\" Automatically generated by Pod::Man 2.22 (Pod::Simple 3.07)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.ie \nF \{\
.    de IX
.    tm Index:\\$1\t\\n%\t"\\$2"
..
.    nr % 0
.    rr F
.\}
.el \{\
.    de IX
..
.\}
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "BRANDYSNAP 1"
.TH BRANDYSNAP 1 "2011-11-06" "perl v5.10.1" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
brandysnap \- rsync snapshot manager
.SH "SYNOPSYS"
.IX Header "SYNOPSYS"
brandysnap [\s-1OPTION\s0...]
.PP
typically
.PP
brandysnap \-\-conf brandysnap.conf [\s-1OTHER\s0 \s-1OPTIONS\s0...]
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
.Vb 3
\& This is part of the brandysnap documentation.
\& Copyright &copy; 2011  Chris Dennis  chris@starsoftanalysis.co.uk
\& See the file fdl\-1.3.txt for copying conditions.
.Ve
.PP
Brandysnap is (yet another) script that uses rsync to create snapshot backups of files and directories.
.PP
It is still being developed, and should be considered very experimental software.  Use it at your own risk!
On the other hand, it's getting better: the author already uses it 'in production'.
.PP
It is designed to be flexible and robust.  In particular, it copes well with situations where snapshots are not created as regularly as they should be.  This can be for a variety of reasons \*(-- hardware failure, operator failure, weekends, holidays, someone forgot to plug in the external \s-1USB\s0 drive...
.PP
Rather than assigning 'importance' to snapshots according to when they were made (for example, keeping Friday afternoon backups for longer than Tuesday morning ones), it looks at what snapshots exist and decides if any can be deleted.  If the Friday afternoon backup is missing, it will keep the nearest one it can find.
.PP
The basic rule is 'backup first, ask questions later'.  Brandysnap assumes that snapshots are cheap \*(-- in both time and space.  In other words, making a snapshot is quick, and uses relatively little disk space because of the use of hard links.  (Of course the first snapshot is not cheap.  And snapshots over a network are never particularly quick.)
.PP
It therefore creates a new snapshot every time it is run, and then thinks about which snapshots, if any, are no longer required.
.PP
Brandysnap tries to cope with any situation.  Either the source or the destination can be on a remote computer (but not both at the same time).
.PP
Brandysnap is designed to be run regularly from cron (or similar automation system).  It can also be run manually if required without upsetting things.
.PP
Brandysnap has been developed on Linux.  It is written in Perl and uses a selection of fairly standard modules (all available in Ubuntu repositories, and no doubt elsewhere too).  It relies on hard links [see ...] and will only work properly when creating snapshots on a filing system that can handle hard links, such as ext3 or ext4 [and others...].
.PP
Lots of snapshots don't make a file more secure: if the file hasn't changed, and is the same in all snapshots, then it is only stored once on the disk.  If it gets corrupted for any reason, then it will be corrupted in all snapshots.  (If the file is \s-1DELETED\s0 from one snapshot, it will still exist in the others, because of the way hard links work.) Think of the whole set of snapshots as one backup, with multiple versions of files that have changed.
.SS "Very Quick Start"
.IX Subsection "Very Quick Start"
See the \s-1README\s0 file for brief installation instructions.
.PP
If you want to try it out without reading further, create a configuration file called brandysnap\-test1.conf containing something like this:
.PP
.Vb 5
\&    source      = /path/to/something/to/backup
\&    destination = /path/to/writable/directory
\&    template    = brandysnap\-test1
\&    spec        = 4h1,1h1,1d7
\&    lockfile    = ~/brandysnap\-test1.lock
.Ve
.PP
and then run
.PP
.Vb 1
\&    brandysnap \-\-dry\-run \-\-conf brandysnap\-test1.conf
.Ve
.PP
The \fBdry-run\fR option will mean that nothing will actually be done.  Once you're happy than the script won't break anything, try it without the \fBdry-run\fR.
.PP
For more options, run \fBbrandysnap \-\-help\fR.
.SS "Remote Sources and Destinations"
.IX Subsection "Remote Sources and Destinations"
Brandysnap assumes that any messing about with passwords has been taken care of.
.PP
In other words, it will call rsync on remote directories without supplying a password.
.PP
There are various ways of setting up rsync so that it doesn't prompt for a password \*(-- they are not described here.  [ a reference or two would be helpful here] So it's important to get the password-less access sorted out first.  In fact rsync may be run many times during one run of brandysnap, so suppand rsync would prompt for a password each time.
.PP
Multiple destinations can be configured, in which case snapshots will be created on all destinations that are available.  This can be used to put snapshots on several external \s-1USB\s0 drives in rotation, for example.  Or you could specify one local and one remote destination for security.  But note that multiple destinations won't be in sync with each other that's not the intention.  They will end up with different lists of snapshots if they are available at different times
.SS "Preserving Ownership"
.IX Subsection "Preserving Ownership"
In order to preserver ownership of files, brandysnap needs to be run as root or via 'sudo'.
.PP
[More detail needed here re use of sudo and `remote\-rsync\-cmd = 'sudo rsync'`]
.ie n .SS "<a name=""keepingSnapshots"">Keeping Snapshots</a>"
.el .SS "<a name=``keepingSnapshots''>Keeping Snapshots</a>"
.IX Subsection "<a name=keepingSnapshots>Keeping Snapshots</a>"
The number of snapshots that are made depends on how often brandysnap is run.  It creates a new snapshot every time.  What is more interesting is how many snapshots are \s-1KEPT\s0.  This is 
determined by a series of specifications, or 'specs', such as
.PP
.Vb 1
\&        4d5,3w3,1d11
.Ve
.PP
which is a concise way of saying 'keep four snapshots a day from the last five days, then three a week for three weeks, then one a month for eleven months.  If brandysnap has run successfully for the last year, then there will be at least 4x5 + 3x3 + 1x11 = 40 snapshots.
.PP
Most of the tricky stuff in brandysnap is in deciding which snapshots to keep.
.PP
Each spec is of the form
.PP
.Vb 1
\&        <frequency><period><count>
.Ve
.PP
or
.PP
.Vb 1
\&        <minimum frequency> \- <maximum frequency><period><count>
.Ve
.PP
The 'frequency' is the number of snapshots to be kept in each period.  
It can be a single number from 1 to...whatever is reasonable.  Or it can be a minimum-maximum range: for example \fI0\-4\fR means 'keep between 0 and 4 snapshots in this period'.
.PP
Note that the frequency is not the number of snapshots that will be \s-1CREATED\s0 \*(-- that is determined simply by how often brandysnap is run, and that will usually be down to the way that cron is configured.
.PP
The 'period' is a single letter indicating the time period.  It can be one of
.IP "\(bu" 4
\&\fBh\fR \- hour
.IP "\(bu" 4
\&\fBd\fR \- day
.IP "\(bu" 4
\&\fBw\fR \- week
.IP "\(bu" 4
\&\fBm\fR \- month
.IP "\(bu" 4
\&\fBy\fR \- year
.PP
The period can be given in either upper or lower case.
.PP
The 'count' indicates the number of periods, as a number from 1 to as many as you like.
.PP
If the count is left out, the period is 'padded' to make up to the next period, working backwards in time from 'now'.  For example,
.PP
.Vb 1
\&        4d,2w4
.Ve
.PP
will be interpreted as \fB4d7,2w4\fR.  The 'day' specification is expanded to a week's worth of days to align with the next spec which is in weeks.
.PP
If the last spec has no count, it will be padded 'forever'.  The number of snapshots will only be limited by the available disk space.  And when the disk is full, the oldest snapshots will be deleted.
.PP
More spec examples:
.IP "\(bu" 4
\&\fB1d\fR \- just keep 1 backup every day, with no limit to the number of backups.
.IP "\(bu" 4
\&\fB1h24,4d6,3w3,4m11\fR \- one an hour for the first day, then 4 a day for the rest of the week then 3 a week for the rest of the month, then 4 a month to give a whole year of snapshots.
.IP "\(bu" 4
\&\fB0\-6d5,2\-5w3,4m12\fR \- keep up to 6 snapshots a day for five days, but consider days with no snapshots at all to be valid; them keep between 2 and 5 a week for three weeks, then keep snapshots for 12 months with 4 snapshots in each.
.IP "\(bu" 4
\&...
.PP
Snapshots also get deleted as time passes.  If a day with four snapshots gets to be old enough to fall within a \fB3w\fR spec, then the extra snapshots will be deleted.
.SS "Definition of 'snapshot' vs full/incremental backups"
.IX Subsection "Definition of 'snapshot' vs full/incremental backups"
Lots of snapshots don't make a file more secure: if the file hasn't changed, and is the same in all snapshots, 
then it is only stored once on the disk.  If it gets corrupted for any reason, then it will be corrupted
in all snapshots.  (If the file is \s-1DELETED\s0 from one snapshot, it will still exist in the others, because
of the way hard links work.)
.PP
Think of the whole set of snapshots as one backup, with multiple versions of files that have changed.
.SS "Options"
.IX Subsection "Options"
All options can be given either on the command line or in the configuration file.  Command line options override configuration file ones.  They are case-insensitive.
.PP
On the command line, options must be preceded by one or two hyphens, and can be abbreviated as long as they do not become ambiguous.  An 'equals' sign (\fB=\fR) is optional.  For example:
.PP
.Vb 1
\&    brandysnap \-\-source xyz \-verbose=1 \-\-conf=bs1.conf \-cal false
.Ve
.PP
In the configuration file, leave off the hyphens and don't abbreviate the options.  Lines beginning with '#' are considered to be comments and are ignored.  [These differences between the command line and the configuration file will be fixed...]
.PP
Some options (such as \fBsource\fR and \fBdestination\fR) can be specified more than once.  Note that command line options _always_ override configuration file ones, even for multiple options.  So if you have a list of \fBexclude\fR options in the configuration file, and try to add an extra one on the command line, those in the file will be ignored.
.PP
\&\fB~\fR can be used to specify local files and directories e.g.
.PP
.Vb 1
\&    \-\-logfile = ~/brandysnap.log
.Ve
.PP
The \fB~\fR will be expanded to the home directory of the user who _runs_ brandysnap.  
\&\fB~\fR can also be used on remote directories, e.g. \fBchris@example.com:~/documents\fR.  In this case, the \fB~\fR will be expanded by rsync to mean the home directory of the user specified (or implied) before the \fB@\fR symbol, in this case \fB/home/chris/\fR.
\&\fB~\fR can \s-1NOT\s0 be used in any of the \fBinclude\fR/\fBexclude\fR options.
.IP "\(bu" 4
Options marked with '!' in the following list are required.
.IP "\(bu" 4
Options marked with '*' in the following list can be specified more than once.
.IP "\(bu" 4
\&\fByes/no\fR options can be specified as any of \fByes\fR/\fBtrue\fR/\fBon\fR/\fB1\fR or \fBno\fR/\fBfalse\fR/\fBoff\fR/\fB0\fR.
.SH "OPTIONS"
.IX Header "OPTIONS"
.SS "Main options"
.IX Subsection "Main options"
.IP "\fBconfig \f(BIfile\fB\fR !" 4
.IX Item "config file !"
The name of a file to look in for further options.  Configuration file options will be overridden by command-line ones, irrespective of where the \fBconfig\fR option appears on the command line.
.IP "\fBsource \f(BIfile/dir\fB\fR *!" 4
.IX Item "source file/dir *!"
A local or remote file or directory to add to the snapshot.  Examples:
.Sp
.Vb 3
\&        source ~/Documents
\&        source /home
\&        source chris@example.com:~/Documents
.Ve
.Sp
More than one source can be specified, in which case each source will be rsync'd, one at a time, to each destination in turn.
Rsync can not copy from a remote source to a remote destination, so any source/destination pairs which are both remote will be skipped.
Each source must be readable by the user who runs brandysnap.  If any files or directories within the source are not readable, brandysnap will carry on regardless.
.Sp
See the section on remote authorisation.
.Sp
By default, brandysnap uses the rsync options \fB\-\-archive \-\-hard\-links \-\-one\-filesystem\fR, so the whole of each source will be copied recursively without following symbolic links.  See the \fBrsync-options\fR option for ways to change this.
.IP "\fBdestination \f(BIdir\fB\fR *!" 4
.IX Item "destination dir *!"
A local or remote directory for use as the snapshot destination.  Examples:
.Sp
.Vb 2
\&        destination /backups/
\&        dest chris@example.com:/backups
.Ve
.Sp
More than one destination can be specified (see \fBsource\fR).
.Sp
Each destination must be writable by the user who runs brandysnap.
.Sp
See the section on remote authorisation.
.IP "\fBtemplate \f(BIname\fB\fR !" 4
.IX Item "template name !"
The directory name of each snapshot is of the form
.Sp
.Vb 1
\&        <template>\-<timestamp>
.Ve
.Sp
See the [Snapshot Names section](#snapshotNames) for more details.
Example:
.Sp
.Vb 1
\&        template docs
.Ve
.IP "\fBspec \f(BIstring\fB\fR !" 4
.IX Item "spec string !"
The snapshot-keeping specification.  See the [Keeping Snapshots section](#keepingSnapshots) for full details.
.IP "\fBlockfile \f(BIfile\fB\fR !" 4
.IX Item "lockfile file !"
To prevent separate runs of brandysnap using the same destinations at the same time, you need to give 
the name of temporary file which will be created and locked while brandysnap is running.
The user running brandysnap must have permission to create and delete this file.  For example:
.Sp
.Vb 1
\&        lockfile /tmp/brandysnap\-docs.lock
.Ve
.IP "\fBlogfile \f(BIfile\fB\fR" 4
.IX Item "logfile file"
The name of a file which will be used to log the output from brandysnap.  Examples:
.Sp
.Vb 2
\&        logfile /var/log/brandysnap.log
\&        logfile ~/bs\-docs.log
.Ve
.Sp
The user running brandysnap must have permission to create and write to the log file.
.SS "Tuning options"
.IX Subsection "Tuning options"
.IP "\fBcalendar \f(BIyes/no\fB\fR" 4
.IX Item "calendar yes/no"
In calendar mode, hours start on the hours, days start at midnight, weeks start on Sunday (but see the \fBweekstart\fR option), months start on the 1st of the month, years start on the 1st of January.  Padding is added where necessary to align periods with the calendar.  When calendar mode is turned off, periods are not aligned and are contiguous, ending 'now'.  See the [Calendar Mode section](#calendarMode) below for further details.  (default: \fByes\fR)
.IP "\fBsafe \f(BIyes/no\fB\fR" 4
.IX Item "safe yes/no"
In safe mode, snapshots are only considered for deletion if the specified periods are 'complete' \*(-- i.e. they have the required number of snapshots.  If safe mode is turned off, all periods are considered complete, and extra snapshots in any of them will be deleted. See the [Safe Mode section](#safeMode) below for further details.  (default: \fByes\fR)
.Sp
The \fBxbest\fR options can be used to tune the snapshot-matching algorithm which decides which snapshots should be deleted.  The defaults assume that the latest snapshots within a period are the most valuable, and should be kept.  Note that if calendar mode is turned off, the \fBxbest\fR options are relative to the start of the period: for example \fBwbest = 3\fR means the middle of the week, even if the week happens to start at 5:30am on a Tuesday.
.IP "\fBhbest \f(BI0..59\fB\fR" 4
.IX Item "hbest 0..59"
\&\fBhbest\fR determines the favoured minute within an hour for an hourly specification. For example, to prefer hourly snapshots created in the middle of an hours, use \fBhbest 30\fR.  (default: \fB59\fR)
.IP "\fBdbest \f(BI0..23.9\fB\fR" 4
.IX Item "dbest 0..23.9"
Determines the favoured time within day in hours.  For example, to prefer daily snapshots created at 5pm, use \fBdbest 17\fR. (default: \fB23.9\fR)
.IP "\fBwbest \f(BI1..7\fB\fR" 4
.IX Item "wbest 1..7"
Determines the favoured day within a week, with 1=Sunday, 7=Saturday.  For example, to prefer weekly snapshots created on Friday, use \fBwbest 6\fR. (default: \fB1\fR)
.IP "\fBmbest \f(BI1..31\fB\fR" 4
.IX Item "mbest 1..31"
Determines the favoured day within a month.  For example, to prefer monthly snapshots created at the beginning of the month, use \fBmbest 1\fR.  [This may be improved in the future to allow preferences such as 'the last Friday in the month'. If the value specified is greater than the number of days in a particular month, the last day of the month is used.  To always select the last day of the month, use \fBmbest 31\fR.  (default: \fB31\fR)
.IP "\fBybest \f(BI1..366\fB\fR" 4
.IX Item "ybest 1..366"
Determines the favoured day within a year.  In leap years, the value \fB366\fR is automatically changed to \fB365\fR, so \fB366\fR always means 'the last day of the year'. For example, to prefer yearly snapshots in the middle of the year, use \fBybest 180\fR. (default: \fB366\fR)
.IP "\fBweekstart \f(BI1..7\fB\fR" 4
.IX Item "weekstart 1..7"
Sets the first day of week.  If you consider that weeks start on Monday, use \fBweekstart 2\fR.  \fB1\fR=Sunday, \fB7\fR=Saturday.  (default: \fB1\fR)
.SS "Helpful options"
.IX Subsection "Helpful options"
.IP "\fBhelp \f(BIyes/no\fB\fR" 4
.IX Item "help yes/no"
Prints out a brief summary of options, and then stops. (default: \fBno\fR)
.IP "\fBversion \f(BIyes/no\fB\fR" 4
.IX Item "version yes/no"
Prints out the brandysnap version number only and then stops. (default: \fBno\fR)
.IP "\fBverbose \f(BI0..3\fB\fR" 4
.IX Item "verbose 0..3"
This options sets the verbosity of the printed output, on a scale from \fB0\fR to \fB3\fR.  Use higher values to see more about what brandysnap and rsync are doing.  (default: \fB1\fR)
.IP "\fBloglevel \f(BI0..3\fB\fR" 4
.IX Item "loglevel 0..3"
Sets the verbosity level of output in the log file, on a scale from \fB0\fR to \fB3\fR.  If no \fBlogfile\fR is defined, this option is effectively set to \fB0\fR.  (default: \fB1\fR)
.IP "\fBdry-run \f(BIyes/no\fB\fR" 4
.IX Item "dry-run yes/no"
In \fBdry-run\fR mode, brandysnap goes through the motions, but doesn't actually create or delete any snapshots.  The \fBdry-run\fR option is also passed through to rsync. (default: \fBno\fR)
.SS "Rsync options"
.IX Subsection "Rsync options"
.IP "\fBrsync-cmd \f(BIpath\fB\fR" 4
.IX Item "rsync-cmd path"
The location of the rsync programme on your system.  The default is just \fBrsync\fR which means brandysnap looks for rsync in you normal path. On some systems, you might need to set it to something else such as
.Sp
.Vb 1
\&        rsync\-cmd /usr/bin/rsync
.Ve
.Sp
(default: \fBrsync\fR)
.IP "\fBcompress \f(BIyes/no\fB\fR" 4
.IX Item "compress yes/no"
Enable rsync compression for remote transfers. Note that this only applies compression for transfer across the network: files are expanded again on the destination.  (default: \fByes\fR)
.IP "\fBinclude\fR/\fBinclude-from\fR/\fBexclude\fR/\fBexclude-from \f(BIpattern-or-file\fB\fR *" 4
.IX Item "include/include-from/exclude/exclude-from pattern-or-file *"
These four options are passed through to rsync unchecked and unchanged.  '~' is \s-1NOT\s0 expanded to a home directory.  See the rsync documentation for details.  (default: none)
.IP "\fBbwlimit-in\fR <n>" 4
.IX Item "bwlimit-in <n>"
Band-width limit for receiving in kbps.  Set it to 0 for no limit.  (default: \fB0\fR)
.IP "\fBbwlimit-out\fR <n>" 4
.IX Item "bwlimit-out <n>"
Band-width limit for sending in kbps. Set it to 0 for no limit.  (default: \fB0\fR)
.IP "\fBrsync-opts \f(BIoptions\fB\fR" 4
.IX Item "rsync-opts options"
Options to pass to rsync, in addition to those that brandysnap will always use (i.e. \-\-relative and \-\-link\-dest). Use this only if you know what you are doing.  (default: \-aHx \-\-numeric\-ids)
.SS "Advanced options"
.IX Subsection "Advanced options"
.IP "\fBall-failed \f(BIkeep/rename/delete\fB\fR" 4
.IX Item "all-failed keep/rename/delete"
What to do with the snapshot if none of the sources are copied successfully.
\&\fB\f(BIkeep\fB\fR will mean that the incomplete snapshot will be considered complete, and is not recommended.
\&\fB\f(BIrename\fB\fR will cause the incomplete snapshot to be renamed with a '\fB\-x\fR' suffix: this
means that it will not be considered as a proper snapshot when making future
decisions about what keep.
If you specify \fB\f(BIdelete\fB\fR, the incomplete snapshot will be deleted immediately, in the expectation
that future snapshots will be more successful.
See also \fB\-\-some\-failed\fR.
(default: \fBdelete\fR)
.IP "\fBdelete \f(BIyes/no\fB\fR" 4
.IX Item "delete yes/no"
Delete no-longer-required snapshots.  If this option is turned off, brandysnap will create new snapshots but not delete any old ones. (default: \fByes\fR)
.IP "\fBdelete-cp \f(BIyes/no\fB\fR" 4
.IX Item "delete-cp yes/no"
Include the 'current period' when considering which snapshots to delete.  See the description of [current period](#currentPeriod) below. (default: \fByes\fR)
.IP "\fBexpire-old \f(BIyes/no\fB\fR" 4
.IX Item "expire-old yes/no"
Consider _all_ snapshots (oldest first) as expirable to make room when the destination is full. (default: \fBno\fR)
.IP "\fBldcount \f(BIn\fB\fR" 4
.IX Item "ldcount n"
Specify the number of previous snapshots that rsync will search looking for identical files to hard-link to.  
Normally the default value of \fB1\fR is ideal.  Set this value to \fB0\fR to turn off rsync's \fB\-\-link\-dest\fR option
completely, but be aware that this will greatly increase the size of the new snapshot, and the time
taken to create it (especially over the network).  Values greater than \fB1\fR can be used in conjunction
with [options yet to be implemented] to tune the behaviour of brandysnap. (default: \fB1\fR)
.IP "\fBrestart \f(BIyes/no\fB\fR" 4
.IX Item "restart yes/no"
If a previous run of brandysnap was interrupted for any reason, use this option to re-do the same snapshot (simply by relying on rsync's ability to not copy files that have not changed).  Any files in the source that have changed since the previous run _will_ be updated.  If more than one destination is being used, rsync will be run for _all_ destinations, even if some of them completed successfully before.
.IP "\fBsnapshot \f(BIyes/no\fB\fR" 4
.IX Item "snapshot yes/no"
Create a new snapshot.  If this option is turned off, no new snapshot will be created during this run of brandysnap but old snapshots may be deleted. (default: \fByes\fR)
.IP "\fBsome-failed \f(BIkeep/rename/delete\fB\fR" 4
.IX Item "some-failed keep/rename/delete"
What to do with the snapshot if some of the sources are not copied successfully.  See \fB\-\-all\-failed\fR for details. (default: \fBrename\fR)
.IP "\fBstatus \f(BIyes/no\fB\fR" 4
.IX Item "status yes/no"
Print a status report only, with no snapshots being created or deleted. (default: \fBno\fR)
.IP "\fBstrict \f(BIyes/no\fB\fR" 4
.IX Item "strict yes/no"
Use strict mode \*(-- see the [Strict Mode section](#strictMode). (default: \fBno\fR)
.SS "Development options"
.IX Subsection "Development options"
These options are for use by developers only.
.IP "\fBdebug \f(BI0..3\fB\fR" 4
.IX Item "debug 0..3"
Print and log debugging information. (default: \fB0\fR)
.IP "\fBstacktrace \f(BIyes/no\fB\fR" 4
.IX Item "stacktrace yes/no"
Print a stack trace on error. (default: \fByes\fR)
.IP "\fBtest \f(BIn\fB\fR" 4
.IX Item "test n"
Run test case 'n'.
.SH "FURTHER DETAILS"
.IX Header "FURTHER DETAILS"
.ie n .SS "<a name=""calendarMode"">Calendar mode</a>"
.el .SS "<a name=``calendarMode''>Calendar mode</a>"
.IX Subsection "<a name=calendarMode>Calendar mode</a>"
In 'calendar mode', which is the default, brandysnap works in terms of real weeks and months.  Days always start at midnight, weeks at midnight on Sunday etc. (but see \fB\-\-weekstart\fR option).  In non-calendar mode, the specs are interpreted more simply, working backwards from the moment when brandysnap is run.  There will be no gap between periods: days and weeks can start at any time, depending on when the previous spec ran out.
.ie n .SS "<a name=""safeMode"">Safe mode</a>"
.el .SS "<a name=``safeMode''>Safe mode</a>"
.IX Subsection "<a name=safeMode>Safe mode</a>"
In 'safe mode', which the default, specs will only match against the list of existing snapshots if there are enough snapshots to satisfy the spec's definition.  Incomplete specs will be skipped.  This has the result that brandysnap is less likely to delete snapshots.  This is designed to cater for situations when brandysnap has not run successfully as often as it should have, for whatever reason.  For example, because of weekends or holidays, or because the destination wasn't available because an external \s-1USB\s0 drive wasn't connected (or two or more \s-1USB\s0 drives are being used in rotation).  e.g if the spec is \fB4d5\fR, it's now Monday and brandysnap did not run at the weekend, then the days with fewer than 4 snapshots (i.e. Saturday and Sunday) will be skipped; counting the 5 days will start on Friday and work backwards from there.  Safe mode can be turned off via the \fB\-\-safe\fR option.
.SS "Strict mode"
.IX Subsection "Strict mode"
In 'strict mode', which is not the default, brandysnap will not run if there are minor problems with the specs.  Normally, it will display information about how it has interpreted the specs, and carry on.
.SS "Weeks and months and years"
.IX Subsection "Weeks and months and years"
The fact that months and years do not have whole or fixed numbers of 
weeks makes counting periods awkward.  Brandysnap deals with this by 
skipping over the extra days, and not deleting any of their snapshots.
.SS "Status report"
.IX Subsection "Status report"
Brandysnap displays a status report on all existing snapshots at the end of each run.
.PP
However, if the destination is on a remote computer, the status report does include details of the disk space used by each snapshot because of the process of retrieving that information is slow.
.PP
The full status report can be seen for remote destinations by running brandysnap with the \fB\-\-status\fR option in addition to the usual configuration.  And even then, can only display 'Real size', not 'Delete size', because rsync doesn't give information about the number of hard links.
.ie n .SS "<a name=""snapshotNames"">Snapshot names</a>"
.el .SS "<a name=``snapshotNames''>Snapshot names</a>"
.IX Subsection "<a name=snapshotNames>Snapshot names</a>"
Each snapshot is a separate directory within the destination, with a name of the form
.PP
.Vb 1
\&        <template>\-<timestamp:YYYYMMDD\-hhmmss>
.Ve
.PP
where the 'template' is specified by the \-\-template option.  For example
.PP
.Vb 1
\&        bs1\-20110616\-121159
.Ve
.PP
That format is fixed \*(-- it is used to identify snapshots; any directory that doesn't match that pattern will be ignored.
.SS "Interrupt handling"
.IX Subsection "Interrupt handling"
Brandysnap is designed to be robust: if it receives an interrupt signal, for example if the computer
is shutting down, or the user has pressed ctrl-C, while rsync is running, it traps the signal and stops cleanly, 
deleting any partially completed snapshot if possible.
.SH "KNOWN ISSUES"
.IX Header "KNOWN ISSUES"
As of 5 November 2011 and version 0.1.14, the following issues and bugs are known.
.IP "\(bu" 4
The option \fB\-\-remote\-rsync\-cmd\fR can only be specified once, and applies to all remote sources and directories.
.IP "\(bu" 4
Under certain circumstances, rsync can fail if the source contains files that are hard-linked together
and for which you do not have read permission.  This is fixed in rsync 3.0.9 and later.  You can get
round it by specifying \fB\-\-rsync\-opts\fR with the usual options but omitting \fB\-\-hard\-links\fR.
.IP "\(bu" 4
If the timings of snapshots are slightly out, a snapshot may appear to be in 
the wrong period, which will affect deletions.  
For example, when doing one snapshot a day with calendar mode turned off, if 
yesterday's snapshot was at 11:40:03, and today's is at 11:40:01, 
then yesterday's will be considered as part of today, 
because it is less than 24 hours ago, so it will be deleted.  A fix is planned to address this issue.
.IP "\(bu" 4
When using the \fB\-\-dry\-run\*(--\fR option, rsync sometimes displays an error message that \f(CW\*(C`\-\-link\-dest arg does not exist\*(C'\fR.  
This can be safely ignored.
.IP "\(bu" 4
When daylight savings ends (or the clock goes backwards for any other reason), it is possible
that brandysnap will try to create a new snapshot at exactly the same time as an existing one.
The results of that are 'undefined' \*(-- i.e. I haven't tried it.
.SH "AUTHOR"
.IX Header "AUTHOR"
Chris Dennis, chris@starsoftanalysis.co.uk
